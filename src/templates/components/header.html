<style>
    .dropdown-toggle::after {
        display: none;
    }
    #suggestions {
        position: absolute; /* Позволяет позиционировать список относительно родителя */
        z-index: 1000;     /* Устанавливаем достаточно высокий z-index, чтобы он был выше других элементов */
        background-color: white; /* Задаем фон для выпадающего списка */
        border: 1px solid #ccc;  /* Обводка выпадающего списка */
        max-height: 200px;       /* Максимальная высота списка */
        overflow-y: auto;        /* Прокрутка по вертикали, если слишком много элементов */
        width: 100%;             /* Ширина должна соответствовать ширине родительского */
        display: none;           /* Изначально скрываем блок */
    }

    #suggestions div {
        padding: 10px;          /* Отступы для элементов списка */
        cursor: pointer;        /* Курсор в виде указателя */
    }

    #suggestions div:hover {
        background-color: #f0f0f0; /* Цвет при наведении */
    }

</style>
<div class="container">
    <header class="p-3 mb-3 border-bottom">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                <li>
                    <a 
                        href="{% url 'services_groups' %}"
                        class="nav-link px-2 {% if active_page == 'services' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Услуги
                    </a>
                </li>
                <li>
                    <a 
                        href="{% url 'staff_list' %}"
                        class="nav-link px-2 {% if active_page == 'staff' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Работники
                    </a>
                </li>
                <li>
                    <a 
                        href="{% url 'prices' %}"
                        class="nav-link px-2 {% if active_page == 'prices' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Цены
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link px-2 {% if active_page == 'clinic' %}link-secondary{% else %}link-body-emphasis{% endif %} dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Клиника
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'company' %}">О клинике</a></li>
                        <li><a class="dropdown-item" href="{% url 'licenses' %}">Лицензии</a></li>
                        <li><a class="dropdown-item" href="{% url 'requisites' %}">Реквизиты</a></li>
                    </ul>
                </li>
                <li>
                    <a 
                        href="{% url 'gallery' %}"
                        class="nav-link px-2 {% if active_page == 'works' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Наши работы
                    </a>
                </li>
                <li>
                    <a 
                        href="{% url 'reviews' %}" 
                        class="nav-link px-2 {% if active_page == 'reviews' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Отзывы
                    </a>
                </li>
                <li>
                    <a 
                        href="{% url 'contacts' %}"
                        class="nav-link px-2 {% if active_page == 'contacts' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Контакты
                    </a>
                </li>
            </ul>

            <div class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" role="search">
                <div style="position: relative;"> <!-- Новый контейнер для позиционирования -->
                    <input type="text" class="form-control" placeholder="Поиск" id="search-input" aria-label="Поиск" autocomplete="off">
            
                    <div id="suggestions"></div> <!-- Удалено стиль display: none; будет контролироваться в JS -->
                </div>
            
                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                <script>
                    $(document).ready(function() {
                        function fetchSuggestions(query) {
                            $.ajax({
                                url: "{% url 'search' %}",  // Ensure this URL is correct
                                data: {
                                    'query': query
                                },
                                dataType: 'json',
                                success: function(data) {
                                    $('#suggestions').empty().show(); // Show suggestions
                                    // Combine results from different categories
                                    let allResults = [];
                                    allResults = allResults.concat(data.staff.map(item => ({ name: item.fio })));
                                    allResults = allResults.concat(data.services.map(item => ({ name: item.name })));
                                    allResults = allResults.concat(data.service_groups.map(item => ({ name: item.name })));
                                    allResults = allResults.concat(data.works.map(item => ({ name: item.name })));
                                    allResults = allResults.concat(data.licenses.map(item => ({ name: item.name })));
                                    allResults = allResults.concat(data.pages);

                                    // Add suggestions to the dropdown
                                    $.each(allResults, function(index, result) {
                                        $('#suggestions').append('<div>' + (result.title || result.name) + '</div>');
                                    });

                                    // Hide suggestions if no results
                                    if (allResults.length === 0) {
                                        $('#suggestions').hide();
                                    }
                                }
                            });
                        }

                        $('#search-input').on('keyup', function() {
                            let query = $(this).val();
                            if (query.length > 2) {
                                fetchSuggestions(query);
                            } else {
                                $('#suggestions').hide();
                            }
                        });

                        // Handle click on suggestion
                        $(document).on('click', '#suggestions div', function() {
                            $('#search-input').val($(this).text());
                            $('#suggestions').hide(); // Hide suggestions after selection
                        });

                        // Handle pressing Enter key
                        $('#search-input').on('keydown', function(event) {
                            if (event.key === 'Enter') {
                                window.location.href = '/search/?query=' + encodeURIComponent($(this).val());
                            }
                        });

                        // Close suggestions when clicking outside
                        $(document).on('click', function(event) {
                            if (!$(event.target).closest('#search-input').length && !$(event.target).closest('#suggestions').length) {
                                $('#suggestions').hide();
                            }
                        });

                        // Show suggestions on focus
                        $('#search-input').on('focus', function() {
                            let query = $(this).val();
                            if (query.length > 2) {
                                fetchSuggestions(query);
                            }
                        });
                    });
                </script>
            </div>
        </div>
    </header>
</div>
