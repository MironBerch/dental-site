<style>
    .dropdown-toggle::after {
        display: none;
    }
    #suggestions {
        position: absolute; /* Позволяет позиционировать список относительно родителя */
        z-index: 1000;     /* Устанавливаем достаточно высокий z-index, чтобы он был выше других элементов */
        background-color: white; /* Задаем фон для выпадающего списка */
        border: 1px solid #ccc;  /* Обводка выпадающего списка */
        max-height: 200px;       /* Максимальная высота списка */
        overflow-y: auto;        /* Прокрутка по вертикали, если слишком много элементов */
        width: 100%;             /* Ширина должна соответствовать ширине родительского */
        display: none;           /* Изначально скрываем блок */
    }

    #suggestions div {
        padding: 10px;
        cursor: pointer;
        border-bottom: 1px solid #ccc; /* Разделители между элементами */
    }

    #suggestions div:last-child {
        border-bottom: none; /* Убираем нижнюю границу для последнего элемента */
    }

    #suggestions div:hover {
        background-color: #f0f0f0; /* Цвет при наведении */
    }
</style>

<div class="container">
    <header class="p-3 mb-3 border-bottom">
        <div class="d-flex flex-wrap align-items-center justify-content-center justify-content-lg-start">
            <ul class="nav col-12 col-lg-auto me-lg-auto mb-2 justify-content-center mb-md-0">
                <li>
                    <a 
                        href="{% url 'services_groups' %}"
                        class="nav-link px-2 {% if active_page == 'services' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Услуги
                    </a>
                </li>
                <li>
                    <a 
                        href="{% url 'staff_list' %}"
                        class="nav-link px-2 {% if active_page == 'staff' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Работники
                    </a>
                </li>
                <li>
                    <a 
                        href="{% url 'prices' %}"
                        class="nav-link px-2 {% if active_page == 'prices' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Цены
                    </a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link px-2 {% if active_page == 'clinic' %}link-secondary{% else %}link-body-emphasis{% endif %} dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Клиника
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="{% url 'company' %}">О клинике</a></li>
                        <li><a class="dropdown-item" href="{% url 'licenses' %}">Лицензии</a></li>
                        <li><a class="dropdown-item" href="{% url 'requisites' %}">Реквизиты</a></li>
                    </ul>
                </li>
                <li>
                    <a 
                        href="{% url 'gallery' %}"
                        class="nav-link px-2 {% if active_page == 'works' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Наши работы
                    </a>
                </li>
                <li>
                    <a 
                        href="{% url 'reviews' %}" 
                        class="nav-link px-2 {% if active_page == 'reviews' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Отзывы
                    </a>
                </li>
                <li>
                    <a 
                        href="{% url 'contacts' %}"
                        class="nav-link px-2 {% if active_page == 'contacts' %}link-secondary{% else %}link-body-emphasis{% endif %}"
                    >
                        Контакты
                    </a>
                </li>
            </ul>

            <div class="col-12 col-lg-auto mb-3 mb-lg-0 me-lg-3" role="search">
                <div style="position: relative;"> <!-- Новый контейнер для позиционирования -->
                    <input type="text" class="form-control" placeholder="Поиск" id="search-input" aria-label="Поиск" autocomplete="off">
            
                    <div id="suggestions"></div>
                </div>
            
                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
                <script>
                    $(document).ready(function() {
                        function fetchSuggestions(query) {
                            $.ajax({
                                url: "{% url 'search' %}",  // Убедитесь, что этот URL корректен
                                data: { 'query': query },
                                dataType: 'json',
                                success: function(data) {
                                    $('#suggestions').empty().show(); // Показать список предложений
                                    let allResults = [];

                                    // Перебор всех элементов в data
                                    data.forEach(item => {
                                        if (item.type === 'staff' && item.data) {
                                            // Проверяем наличие нужных полей для staff
                                            if (item.data.fio && item.data.slug) {
                                                allResults.push({
                                                    type: 'staff',
                                                    name: item.data.fio,
                                                    slug: item.data.slug
                                                });
                                            }
                                        } else if (item.type === 'service' && item.data) {
                                            // Проверяем наличие нужных полей для service
                                            if (item.data.name && item.data.slug) {
                                                allResults.push({
                                                    type: 'service',
                                                    name: item.data.name,
                                                    slug: item.data.slug
                                                });
                                            }
                                        } else if (item.type === 'service_group' && item.data) {
                                            // Проверяем наличие нужных полей для service_group
                                            if (item.data.name && item.data.slug) {
                                                allResults.push({
                                                    type: 'service_group',
                                                    name: item.data.name,
                                                    slug: item.data.slug
                                                });
                                            }
                                        } else if (item.type === 'work' && item.data) {
                                            // Проверяем наличие нужных полей для work
                                            if (item.data.name && item.data.slug) {
                                                allResults.push({
                                                    type: 'work',
                                                    name: item.data.name,
                                                    slug: item.data.slug
                                                });
                                            }
                                        } else if (item.type === 'license' && item.data) {
                                            // Проверяем наличие нужных полей для license
                                            if (item.data.name && item.data.slug) {
                                                allResults.push({
                                                    type: 'license',
                                                    name: item.data.name,
                                                    slug: item.data.slug
                                                });
                                            }
                                        } else if (item.type === 'page' && item.data) {
                                            // Проверяем наличие нужных полей для page
                                            if (item.data.title && item.data.url) {
                                                allResults.push({
                                                    type: 'page',
                                                    name: item.data.title,
                                                    slug: item.data.url
                                                });
                                            }
                                        }
                                    });

                                    // Логирование результатов для проверки
                                    console.log('Все результаты:', allResults);

                                    // Добавление предложений в выпадающий список
                                    console.log('Все результаты:', allResults); // Логирование результатов
                                    if (allResults.length > 0) {
                                        $.each(allResults, function(index, result) {
                                            $('#suggestions').append('<div><a href="' + (result.slug || '#') + '">' + result.name + '</a> (' + result.type + ')</div>');
                                        });
                                    } else {
                                        console.log('Нет результатов для отображения.'); // Логирование, если нет результатов
                                    }

                                },
                                error: function() {
                                    $('#suggestions').hide(); // Скрыть, если есть ошибка
                                }
                            });
                        }

                        $('#search-input').on('keyup', function() {
                            let query = $(this).val();
                            if (query.length > 2) {
                                fetchSuggestions(query);
                            } else {
                                $('#suggestions').hide();
                            }
                        });

                        // Обработка клика по предложению
                        $(document).on('click', '#suggestions div', function() {
                            $('#search-input').val($(this).text());
                            $('#suggestions').hide(); // Скрыть предложения после выбора
                        });

                        // Обработка нажатия клавиши Enter
                        $('#search-input').on('keydown', function(event) {
                            if (event.key === 'Enter') {
                                window.location.href = '/search/?query=' + encodeURIComponent($(this).val());
                            }
                        });

                        // Закрытие предложений при клике вне
                        $(document).on('click', function(event) {
                            if (!$(event.target).closest('#search-input').length && !$(event.target).closest('#suggestions').length) {
                                $('#suggestions').hide();
                            }
                        });

                        // Показать предложения при фокусе
                        $('#search-input').on('focus', function() {
                            let query = $(this).val();
                            if (query.length > 2) {
                                fetchSuggestions(query);
                            }
                        });
                    });
                </script>
            </div>
        </div>
    </header>
</div>
